#! /bin/bash

podman build \
    --tls-verify=false \
    -t localhost:5000/uberbase-traefik:latest \
    traefik/

podman run \
    -d \
    --user 0 \
    --restart unless-stopped \
    --name traefik \
    --env-file ${UBERBASE_VAULT_STORAGE}/credentials \
    --env VAULT_ADDR=http://${UBERBASE_VAULT_HOST}:${UBERBASE_VAULT_PORT} \
    -v ${PWD}/_configs/traefik:/etc/traefik/config \
    -v ${PWD}/logs:/var/log/traefik:Z \
    -v ${UBERBASE_TRAEFIK_STORAGE}:/data:Z \
    -p 80:80 \
    -p 443:443 \
    localhost:5000/uberbase-traefik:latest \
    traefik \
    --configFile=/etc/traefik/config/static/traefik.yml
