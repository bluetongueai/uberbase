#! /bin/bash

# create a 20GB thin pool using loop devices (dev only, not for production)
echo "creating thin pool"
if [ -e ${PWD}/data/lvm ]; then
  fallocate -l 20G ${PWD}/data/lvm
fi
modprobe dm_thin_pool
lo_dev=$(losetup -f)
losetup $lo_dev ${PWD}/data/lvm
vgcreate vg0 $lo_dev
lvcreate -L 18G --thinpool containerd-thinpool vg0
vgchange -a y
