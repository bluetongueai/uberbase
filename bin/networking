#! /bin/bash

# bridge
sudo ip link add name br0 type bridge

# for each device
# tunnel/tap interface
sudo ip tuntap add tap0 mode tap
# assign IP
sudo ip addr add 172.16.0.1/24 dev tap0
# allow traffic from eth0 to tap
sudo ip link set tap0 up
sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i tap0 -o eth0 -j ACCEPT
