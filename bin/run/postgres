#! /bin/bash

podman run \
    -d \
    --user postgres \
    --replace \
    --restart unless-stopped \
    --name postgres \
    --env-file ${UBERBASE_VAULT_STORAGE}/credentials \
    --env VAULT_ADDR=https://${UBERBASE_VAULT_HOST}:${UBERBASE_VAULT_PORT} \
    -v ${PWD}/logs:/var/log/postgresql \
    -v ${PWD}/postgres/_init:/docker-entrypoint-initdb.d \
    -v ${PWD}/postgres/conf/postgresql.conf:/etc/postgresql.conf \
    -v ${PWD}/postgres/conf/pg_hba.conf:/etc/pg_hba.conf \
    -v postgres_data:/var/lib/postgresql/data \
    --network host \
    --add-host uberbase:0.0.0.0 \
    uberbase.local/uberbase-postgres:latest \
    postgres -c config_file=/etc/postgresql.conf

