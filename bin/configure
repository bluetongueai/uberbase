#!/bin/bash

export UBERBASE_PLATFORM="`arch | sed s/arm64/aarch64/ | sed s/amd64/x86_64/`"


mkdir -p postgres/init
cp postgres/_init/* postgres/init/.

rm -Rf ./configs
mkdir -p ./configs/caddy
mkdir -p ./configs/functions
mkdir -p ./configs/postgrest

if [ -f ./.env ]; then
  source ./.env && envsubst < ./caddy/Caddyfile.template > ./configs/caddy/Caddyfile
  source ./.env && envsubst < ./functions/config.template.json > ./configs/functions/config.json
  source ./.env && envsubst < ./postgrest/postgrest.template.conf > ./configs/postgrest/postgrest.conf
else
  envsubst < ./caddy/Caddyfile.template > ./configs/caddy/Caddyfile
  envsubst < ./functions/config.template.json > ./configs/functions/config.json
  envsubst < ./postgrest/postgrest.template.conf > ./configs/postgrest/postgrest.conf
fi

