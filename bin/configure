#!/bin/bash

set -a
source .env
set +a

export UBERBASE_PLATFORM="`arch | sed s/arm64/aarch64/ | sed s/amd64/x86_64/`"

mkdir -p configs/caddy
if [ ! -f ./configs/caddy/Caddyfile ]; then
  envsubst < ./caddy/Caddyfile.template > ./configs/caddy/Caddyfile
fi
mkdir -p configs/functions
if [ ! -f ./configs/functions/config.json ]; then
  envsubst < ./functions/config.template.json > ./configs/functions/config.json
fi
mkdir -p configs/postgrest
if [ ! -f ./configs/postgrest/postgrest.conf ]; then
  envsubst < ./postgrest/postgrest.template.conf > ./configs/postgrest/postgrest.conf
fi

mkdir -p data/postgres
chown 999 -R ./data/postgres
mkdir -p data/redis
mkdir -p data/minio
