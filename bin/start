#! /bin/bash

echo ""
echo "  __  _____  _______  ___  ___   ________"
echo " / / / / _ )/ __/ _ \/ _ )/ _ | / __/ __/"
echo "/ /_/ / _  / _// , _/ _  / __ |_\ \/ _/"  
echo "\____/____/___/_/|_/____/_/ |_/___/___/"  
echo ""
echo ""

platform=$(uname -m)
echo -e "Starting \033[33muberbase\033[0m..."
export UBERBASE_PLATFORM="`arch | sed s/arm64/aarch64/ | sed s/amd64/x86_64/`"
echo -e "Starting on \033[33m$UBERBASE_PLATFORM\033[0m"

./bin/stop

./bin/configure

./bin/build/postgres
./bin/build/redis
./bin/build/minio
./bin/build/fusionauth
./bin/build/traefik

./bin/run/vault
./bin/run/registry
./bin/run/postgres
./bin/run/redis
./bin/run/minio
./bin/run/fusionauth
./bin/run/traefik

# Start the uberbase api
exec ./bin/uberbase serve ./_configs/functions/config.json
